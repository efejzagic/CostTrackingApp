version: '3.4'

networks:
  dev:
    driver: bridge

services:
  storage.webapi:
    image: ${DOCKER_REGISTRY-}storagewebapi
    depends_on:
      - "storage-db"
    container_name: storage-service
    ports:
      - "7009:80" 
    build:
      context: .
      dockerfile: Storage.WebAPI/Dockerfile
    environment:
      - ConnectionStrings__StorageConnection=User ID=postgres;Password=password;Server=storage-db;Port=5432;Database=stgdb;IntegratedSecurity=true;Pooling=true;
      - ASPNETCORE_URLS=http://+:80
    networks:
      - dev
  storage-db:
    image: postgres:latest
    container_name: storage-db
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password  
      - POSTGRES_DB=stgdb
    ports: 
      - "5433:5432"
    restart: always
    volumes:
      - app_data:/var/lib/postgresql/st_data
    networks:
      - dev

  equipment.webapi:
    image: ${DOCKER_REGISTRY-}equipmentwebapi
    depends_on:
      - "equipment-db"
    container_name: equipment-service
    ports:
      - "7019:80" 
    build:
      context: .
      dockerfile: Equipment.WebAPI/Dockerfile
    environment:
      - ConnectionStrings__EquipmentConnection=User ID=postgres;Password=password;Server=equipment-db;Port=5432;Database=eqdb;IntegratedSecurity=true;Pooling=true;
      - ASPNETCORE_URLS=http://+:80
    networks:
      - dev

  equipment-db:
    image: postgres:latest
    container_name: equipment-db
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password  
      - POSTGRES_DB=eqdb
    ports: 
      - "5434:5432"
    restart: always
    volumes:
      - app_data:/var/lib/postgresql/eq_data
    networks:
      - dev


  constructionsite.webapi:
    image: ${DOCKER_REGISTRY-}constructionsitewebapi
    build:
      context: .
      dockerfile: ConstructionSite.WebAPI/Dockerfile

volumes:
  app_data:




